<!doctype html>
<html lang="th">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å | Dentalcare Clinic</title>
    <link rel="stylesheet" href="/public/css/styles.css" />
    <style>
        .relative { position: relative; }
        .toggle { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: transparent; border: 0; cursor: pointer; opacity: .75; }
        .toggle:hover { opacity: 1; }
        .bar { height: 8px; background: #e8f4fd; border-radius: 999px; overflow: hidden; margin-top: 6px; }
        .bar span { display: block; height: 100%; width: 0; background: #22c55e; transition: width .25s; }
        .alert { color: #fff; background: #dc3545; padding: 10px; border-radius: 6px; margin-bottom: 12px; display: none; }
        .grid-2 { display: grid; gap: 14px; }
        @media(min-width:900px) { .grid-2 { grid-template-columns: 1fr 1fr; } }
        .actions { display: flex; gap: 10px; align-items: center; justify-content: space-between; margin-top: 16px; }
        .grid-3 { display: grid; gap: 14px; }
        @media(min-width:900px) { .grid-3 { grid-template-columns: repeat(3, 1fr); } }
    </style>
</head>

<body>
    <main>
        <section class="wrap">
            <div class="brand">
                <div class="logo"><img src="/public/css/logo.png" alt="Dentalcare Logo"></div>
                <div>
                    <h1>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h1>
                    <p class="sub">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°</p>
                </div>
            </div>

            <div class="card">
                <div id="form-error" class="alert"></div>

                <form id="registerForm" oninput="updateStrength('password')">
                    <div class="grid-3">
                        <div>
                            <label for="pre_name">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠</label>
                            <select id="pre_name" name="pre_name" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                                <option>‡∏ô‡∏≤‡∏¢</option>
                                <option>‡∏ô‡∏≤‡∏á</option>
                                <option>‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
                            </select>
                        </div>
                        <div>
                            <label for="first_name">‡∏ä‡∏∑‡πà‡∏≠</label>
                            <input type="text" id="first_name" name="first_name" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á">
                        </div>
                        <div>
                            <label for="last_name">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="last_name" name="last_name" required placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                        </div>
                    </div>

                    <div class="grid-2">
                        <div>
                            <label for="gender">‡πÄ‡∏û‡∏®</label>
                            <select id="gender" name="gender" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                                <option>‡∏ä‡∏≤‡∏¢</option>
                                <option>‡∏´‡∏ç‡∏¥‡∏á</option>
                                <option>‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
                            </select>
                        </div>
                        <div>
                            <label for="birth_date">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label>
                            <input type="date" id="birth_date" name="birth_date" required>
                        </div>
                    </div>

                    <div class="grid-3">
                        <div>
                            <label for="race">‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡∏ï‡∏¥</label>
                            <input type="text" id="race" name="race" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏ó‡∏¢" required>
                        </div>
                        <div>
                            <label for="nationality">‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏¥</label>
                            <input type="text" id="nationality" name="nationality" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏ó‡∏¢" required>
                        </div>
                        <div>
                            <label for="religion">‡∏®‡∏≤‡∏™‡∏ô‡∏≤</label>
                            <input type="text" id="religion" name="religion" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏∏‡∏ó‡∏ò" required>
                        </div>
                    </div>
                    
                    <div>
                        <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <input type="tel" id="phone" name="phone" placeholder="080xxxxxxx" maxlength="10" inputmode="tel" required>
                    </div>

                    <div>
                        <label for="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <input type="email" id="email" name="email" placeholder="name@example.com">
                    </div>

                    <div>
                        <label for="address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
                        <textarea id="address" name="address" rows="2" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô"></textarea>
                    </div>

                    <div>
                        <label for="drug_allergy">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏û‡πâ‡∏¢‡∏≤</label>
                        <textarea id="drug_allergy" name="drug_allergy" rows="2" placeholder="‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á"></textarea>
                    </div>

                    <hr style="margin: 20px 0; border: 1px solid #eee;">

                    <div>
                        <label for="citizen_id">‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Username)</label>
                        <input type="text" id="citizen_id" name="citizen_id" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å 13 ‡∏´‡∏•‡∏±‡∏Å" maxlength="13" inputmode="numeric">
                    </div>

                    <div class="grid-2">
                        <div>
                            <label for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                            <div class="relative">
                                <input type="password" id="password" name="password" required placeholder="‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£">
                                <button class="toggle" type="button" onclick="toggleVisibility('password')">üëÅÔ∏è</button>
                            </div>
                            <div class="bar"><span id="bar"></span></div>
                        </div>
                        <div>
                            <label for="confirm_password">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                            <div class="relative">
                                <input type="password" id="confirm_password" name="confirm_password" required placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á">
                                <button class="toggle" type="button" onclick="toggleVisibility('confirm_password')">üëÅÔ∏è</button>
                            </div>
                        </div>
                    </div>

                    <div class="actions">
                        <a class="link" href="/login">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
                        <button class="primary" type="submit">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <script>
        function strength(pw) {
            let s = 0;
            if (pw.length >= 8) s++;
            if (/[A-Z]/.test(pw)) s++;
            if (/[a-z]/.test(pw)) s++;
            if (/[0-9]/.test(pw)) s++;
            if (/[^A-Za-z0-9]/.test(pw)) s++;
            return Math.min(s, 4);
        }

        function toggleVisibility(id) {
            const el = document.getElementById(id);
            el.type = el.type === 'password' ? 'text' : 'password';
        }

        function updateStrength(id) {
            const el = document.getElementById(id);
            const bar = document.getElementById('bar');
            if (!el || !bar) return;
            const s = strength(el.value);
            bar.style.width = ['0%', '25%', '50%', '75%', '100%'][s];
        }

        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            const errorDiv = document.getElementById('form-error');

            // Client-side validation
            if (data.password !== data.confirm_password) {
                errorDiv.style.display = 'block';
                errorDiv.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô';
                return;
            }
            errorDiv.style.display = 'none';

            try {
                const response = await fetch('/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    alert(result.message);
                    window.location.href = '/login';
                } else {
                    errorDiv.style.display = 'block';
                    errorDiv.textContent = result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å';
                }
            } catch (error) {
                errorDiv.style.display = 'block';
                errorDiv.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå';
            }
        });
    </script>
</body>

</html>
