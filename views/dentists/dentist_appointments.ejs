<!DOCTYPE html>
<html lang="th">
<head>
    <%- include('../partials/head') %>
    <title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</title>
    <link rel="stylesheet" href="/public/css/dentist_appointment.css" />
</head>
<body>
    <%- include('../partials/navbar') %>
    <div class="layout-container">
        
        <main class="main-content">
            
            
            <div class="appointment-container">
                <div class="header-section">
                    <h1>‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>
                    <div class="date-controls">
                        <input type="date" id="selectedDate" value="<%= date %>">
                        <button id="btnToday" class="btn-today">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                    </div>
                </div>

                <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-number"><%= cases.filter(c => c.status === 'CONFIRMED').length %></div>
                        <div class="stat-label">‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number"><%= cases.filter(c => c.status === 'PENDING').length %></div>
                        <div class="stat-label">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number"><%= cases.length %></div>
                        <div class="stat-label">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    </div>
                </div>

                <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏Ñ‡∏™ -->
                <div class="cases-section">
                    <h2 class="section-title">‡πÄ‡∏Ñ‡∏™‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <%= new Date(date).toLocaleDateString('th-TH') %></h2>
                    
                    <% if (cases.length > 0) { %>
                        <div class="table-responsive">
                            <table class="table cases-table">
                                <thead>
                                    <tr>
                                        <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                                        <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°</th>
                                        <th>‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</th>
                                        <th>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</th>
                                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% cases.forEach(c => { %>
                                        <tr>
                                            <td><%= c.slot_text %></td>
                                            <td><%= c.unit_name %></td>
                                            <td>
                                                <strong><%= c.patient_name %></strong>
                                                <% if (c.clinic_number) { %>
                                                    <br><small class="text-muted"><%= c.clinic_number %></small>
                                                <% } %>
                                            </td>
                                            <td><%= c.treatment || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' %></td>
                                            <td>
                                                <span class="status-badge status-<%= c.status.toLowerCase() %>">
                                                    <%= getStatusText(c.status) %>
                                                </span>
                                            </td>
                                            <td class="action-buttons">
                                                <% if (c.status === 'CONFIRMED') { %>
                                                    <a href="/dentist/new/<%= c.patient_id %>" 
                                                       class="btn-action btn-success"
                                                       title="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤">
                                                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤
                                                    </a>
                                                <% } else if (c.status === 'PENDING') { %>
                                                    <button class="btn-action btn-secondary" disabled>
                                                        ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                                                    </button>
                                                <% } else { %>
                                                    <span class="text-muted">-</span>
                                                <% } %>
                                                
                                                <a href="/dentist/patients/<%= c.patient_id %>/history" 
                                                   class="btn-action btn-primary"
                                                   title="‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥">
                                                    ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                                                </a>
                                            </td>
                                        </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>
                    <% } else { %>
                        <div class="empty-state">
                            <div class="empty-icon">üìÖ</div>
                            <h3>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h3>
                            <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <%= new Date(date).toLocaleDateString('th-TH') %></p>
                        </div>
                    <% } %>
                </div>
            </div>
        </main>
    </div>

    <script src="/public/js/dentist_appointments.js"></script>
</body>
</html>