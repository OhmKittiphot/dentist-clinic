<!DOCTYPE html>
<html lang="th">
<head>
  <%- include('../partials/head') %>
  <title>ลงเวลาว่างทันตแพทย์ · DentalCare</title>
  <link rel="stylesheet" href="/public/css/dentisttime.css">
</head>
<body>
  <div class="app">
    <%- include('../partials/navbar', { user: user, userRole: userRole, page: 'dentisttime' }) %>

    <main class="main-content">
      <h1 class="title">ลงเวลาว่าง (แพทย์)</h1>

      <div class="card">
        <div class="toolbar">
          <label>วันที่ <input id="date" type="date" /></label>
          <span class="muted">แพทย์: <strong><%= user?.full_name || user?.username %></strong></span>
          <label>Unit <select id="unitSel"></select></label>
          <button id="today" class="chip" type="button">วันนี้</button>
          <button id="tomorrow" class="chip" type="button">พรุ่งนี้</button>
        </div>

        <div class="muted" id="label"></div>
        <div id="slots" class="slots" role="grid" aria-label="ช่วงเวลาว่าง"></div>

        <div class="footer">
          <button class="btn gray" id="btnClear" type="button">ล้าง</button>
          <button id="btnSave" class="btn primary" type="button" disabled>บันทึกเวลาว่าง</button>
        </div>
      </div>

      <div class="card">
        <h3 class="title" style="font-size:1rem">เคสวันนี้</h3>
        <div class="cases-wrap">
          <table class="cases-table">
            <thead>
              <tr>
                <th>เวลา</th>
                <th>Unit</th>
                <th>ผู้ป่วย</th>
                <th>บริการ</th>
              </tr>
            </thead>
            <tbody id="agendaBody">
              <% if (Array.isArray(cases) && cases.length) { %>
                <% cases.forEach(c => { %>
                  <tr>
                    <td><%= c.slot_text %></td>
                    <td><%= c.unit_name %></td>
                    <td><%= c.patient_name %></td>
                    <td><a href="/dentist/new/<%= c.patient_id %>" class="chip chip-edit">บันทึกการรักษา</a></td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr><td colspan="4" class="muted" style="text-align:center;padding:16px">ยังไม่มีเคสวันนี้</td></tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <script src="/public/js/dentisttime.js"></script>
</body>
</html>
